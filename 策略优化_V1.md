一、诊断与定位（基于前期结果）

风控过严 → 错过行情：MDD -5% 过于约束，-10%/-15%显著提升捕捉上涨段，但回撤随之增大。

宏观开关“过度保守”：DXY↑/人民币↓常触发保守，压低了强势窗口的进攻性。

横截面分位数对股票池敏感：扩池/换池会改变因子分位，导致回测可比性下降。

行业/风格映射不足：科技、消费等未与对应指数强弱充分联动，导致选股信噪比不稳。

二、优化杠杆（按优先级）
A. 快速收益类（优先落地）

动态阈值与仓位随波动自适应

用 HS300 的近60日实现波动 σ_mkt 做缩放：
buy_th = base_buy_th - k1 * z(σ_mkt)，sell_th = base_sell_th + k2 * z(σ_mkt)；
波动低→降低买入阈值、加大目标仓位；波动高→反之。

替换“固定 target_exposure”为：target = clip(base * f(σ_mkt), floor, 1.0)，建议 f(σ)=1/(1+a·z(σ))。

仓位按“波动均衡 + Kelly-lite”分配

单票权重 w_i ∝ score_i⁺ / vol_i，其中 score_i⁺ = max(score_i - buy_th, 0)；

Kelly-lite：对权重总量乘以 λ ∈ [0.3, 0.6]，抑制过度杠杆；

先“卖后买”，买入按目标再按100股向下取整，剩余现金留存，降低换手。

进出场“滞回带（Hysteresis）”减少抖动

买入阈值 buy_th、卖出阈值 sell_th 之间留安全带：

入场：score > buy_th；

持有：只在 score < sell_th 才卖，避免来回穿越造成频繁换手。

行业/风格映射 + 残差动量

对每只股票回归到其主导指数（如：科技→创业板/科创ETF，消费→中证消费等），取残差收益动量：
resid_ret = ret_stock - β * ret_index，动量与波动均以残差计算；

目的：剔除共振的“市场/风格Beta”，提升“个股Alpha”纯度。

风险闸门“软控制”

由“一刀切清仓”改为线性收缩：当 DD 从 -5% 到 -15% 之间，target_exposure 从 base 线性降到 0；

避免刚触发就被动卖在最低点，同时也防止回撤扩大不收手。

B. 结构升级（次优先）

广度/量能/资金面代理（月内先用可得数据）

广度：%成分股 > MA20、多空家数差、过去5日创新高-创新低；

量能：指数/行业ETF的成交额均线比值（5/20/60）；

北向净流（若有）：作为风险偏好代理；

用这些构成Risk-ON分数，影响target_exposure（0.8×~1.1×）与buy_th/sell_th微调。

宏观开关改“阈值微调器”

不再直接设定“保守/激进”档，而是以小幅影响：

macro_bear：target_exposure *= 0.8，buy_th += 0.02，sell_th += 0.02；

macro_bull：target_exposure = min(1.0, target*1.05)，buy_th -= 0.02；

保留方向性提示，避免过度抑制交易。

分桶与限额

科技/消费/周期/医药等分组最大持仓数与单组权重上限（如组内 ≤40%），降低集中回撤。

C. 研究增强（并行推进）

自适应权重学习（无未来泄露）

每日t：在 t-1 回看 252 日，做一次岭回归/ElasticNet：
next_5d_ret ~ mom_short + mom_long + (-vol) + breadth + liquidity + residual_mom ...

得到系数 w_t，生成当日组合打分：score_t = Σ w_t·factor_t；

这是一种“稳健加权”，在不同年份能自动调节动量/波动的相对权重。

极端行情保护

“跌停/大跳空”计数超过阈值 → 暂停加仓 N 日；

指数连跌 N 日且σ_mkt飙升 → 将target_exposure 快速拉低至 ≤0.3。

三、信号与打分（更新版）

每天 t（用于 t+1 执行）：

计算：

残差收益 resid_ret（对行业/风格指数回归，滚动 β）；

mom_short = Σ(resid_ret, 10)，mom_long = Σ(resid_ret, 60)，vol60 = std(resid_ret, 60)；

横截面排名 0–1：mom_short_r/mom_long_r/vol_r。

市场模式：base_regime（HS300 ma20/ma100 & vol20/60）、rally_flag；

广度/量能/资金面 risk_on_score ∈ [0,1]；

宏观微调标志（DXY/CNYUSD）；

组合打分：

score_base = α1*mom_short_r + α2*mom_long_r + α3*(-vol_r)；

α可固定（如 0.6/0.3/0.1）或由岭回归滚动学习；

score = score_base + γ * residual_mom_rank（残差动量附加项）。

阈值与仓位：

基于 base_regime & rally 给出（risk_on/neutral/risk_off）档的 (buy_th, sell_th, base_target, max_positions)；

用 σ_mkt、risk_on_score、macro 微调；

风控将 target_exposure 按回撤线性收缩。

四、交易执行（保持T+1与整手）

先卖后买；

T+1：当日买入标记 buy_tag，次日才允许卖；当日卖出可买回；

整手：买入向下取 floor(value/price/100)*100；

优先级：按 score - buy_th 距离排序；

持仓再平衡：仅当偏离目标>15%才触发，避免频繁微调。

五、参数初值（建议）

动量窗口：mom_short=10，mom_long=60；波动窗口：vol=60；

risk_on：buy_th=0.60，sell_th=0.30，base_target=0.95，max_pos=14；

neutral：buy_th=0.57，sell_th=0.32，base_target=0.65，max_pos=10；

risk_off：buy_th=0.00，sell_th=-0.20，base_target=0.25，max_pos=6；

波动自适应：a=0.35，k1=k2=0.08；

Kelly-lite 缩放：λ=0.45；

风险闸门：MDD 下限 -5% 开始线性收缩，-15% 收到 0；

组权上限：单行业 ≤ 40%。

六、验证与对照（必须做）

时间切片：2018–2025，逐年与“连续”双口径。

对照组：

原策略（固定阈值 + 固定仓位）；

只换“波动自适应”；

再加“残差动量”；

再加“广度/量能”；

再加“宏观微调”。

评估指标：年/月收益、MDD、Calmar、换手、费用/收益占比、Top10 贡献/拖累。

稳定性：参数 ±10% 扰动，结果敏感性；股票池冻结 vs 扩池对比。

事件窗：2024-09 超级行情，确认能否“降阈/加仓”及时跟上。

七、落地顺序（建议）

先上 波动自适应 + hysteresis + Kelly-lite 配仓（最快提升收益/降低噪音）；

接入 残差动量（行业/风格映射）与组限额；

加入 广度/量能/资金面微调与宏观轻微调；

最后上 滚动岭回归自动调权（不偷看未来）。
